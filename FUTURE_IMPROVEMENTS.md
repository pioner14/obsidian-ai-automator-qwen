## Будущие улучшения и оптимизации проекта "Obsidian AI Automator"

Этот документ описывает потенциальные улучшения и оптимизации для проекта, направленные на повышение эффективности, надежности и удобства использования, при этом стараясь не усложнять архитектуру чрезмерно.

### 1. Оптимизация механизма мониторинга папки (inotify)

**Текущая проблема:** Текущий механизм мониторинга папки `WATCH_DIR` основан на периодическом опросе с помощью команды `find`. Это может быть неэффективно и ресурсоемко для больших директорий или при очень частых интервалах опроса, так как ЦП и диск постоянно активируются.

**Предлагаемое улучшение:** Заменить механизм опроса на событийно-ориентированный подход с использованием `inotify` (встроенного в ядро Linux).

*   **Реализация:** Создать отдельный Python-скрипт, использующий библиотеку `watchdog` (или аналогичную), которая предоставляет удобный интерфейс для `inotify`. Этот скрипт будет "слушать" события файловой системы (например, создание нового файла) в `WATCH_DIR`.
*   **Преимущества:**
    *   **Эффективность:** Значительно снижает потребление системных ресурсов (ЦП, диск, энергопотребление), так как скрипт "спит" до тех пор, пока не произойдет реальное изменение.
    *   **Мгновенная реакция:** Обработка файлов начинается практически сразу после их появления, без задержки, связанной с интервалом опроса.
*   **Интеграция:** `watch_and_transcribe.sh` будет запускать этот Python-скрипт мониторинга, который, в свою очередь, будет вызывать `obsidian-ai-transcribe.sh` при обнаружении нового файла.

### 2. Улучшенная обработка ошибок и уведомления

**Текущая проблема:** Ошибки в процессе транскрибации или анализа LLM записываются в логи, но нет активного механизма уведомления пользователя.

**Предлагаемое улучшение:** Внедрить систему уведомлений о критических ошибках.

*   **Реализация:**
    *   Интегрировать отправку уведомлений (например, по электронной почте, через Telegram-бота или push-уведомления) при возникновении ошибок в `ai_analyzer.py` (например, проблемы с API-ключами, сбои Deepgram/NVIDIA API, пустой транскрипт).
    *   Добавить более детальную информацию об ошибке в уведомление.
*   **Преимущества:** Пользователь будет оперативно информирован о проблемах, требующих внимания, что повысит надежность рабочего процесса.

### 3. Централизованное управление конфигурацией

**Текущая проблема:** Некоторые параметры конфигурации (например, `OBSIDIAN_VAULT_PATH`, `NVIDIA_MODEL`) жестко закодированы в скриптах или разбросаны по разным файлам.

**Предлагаемое улучшение:** Объединить все настраиваемые параметры в одном централизованном файле конфигурации.

*   **Реализация:** Использовать файл `config.ini` (с библиотекой `configparser` в Python) или `config.json` для хранения всех настроек. Скрипты будут считывать параметры из этого файла.
*   **Преимущества:** Упрощает управление конфигурацией, делает проект более гибким и легким для настройки без изменения кода.

### 4. Более надежная фильтрация типов файлов

**Текущая проблема:** Текущая фильтрация по MIME-типу может быть не всегда точной или достаточной.

**Предлагаемое улучшение:** Расширить и сделать более гибкой логику определения и фильтрации файлов.

*   **Реализация:**
    *   Добавить возможность настройки списка разрешенных расширений файлов (например, `.mp4`, `.mov`, `.mkv`, `.mp3`, `.wav`) в файле конфигурации.
    *   Использовать более надежные методы определения типа файла, если `file --mime-type` окажется недостаточным.
*   **Преимущества:** Предотвращает попытки обработки неподдерживаемых файлов и дает пользователю больше контроля.

### 5. Параллельная обработка файлов

**Текущая проблема:** Скрипт обрабатывает файлы последовательно, один за другим.

**Предлагаемое улучшение:** Внедрить параллельную обработку для нескольких файлов, обнаруженных в `WATCH_DIR`.

*   **Реализация:**
    *   В `watch_and_transcribe.sh` использовать `xargs -P N` (где N — количество параллельных процессов) для запуска `obsidian-ai-transcribe.sh` для нескольких файлов одновременно.
    *   В Python-скрипте мониторинга (если он будет реализован) использовать `multiprocessing.Pool` для параллельного вызова `obsidian-ai-transcribe.sh`.
*   **Преимущества:** Значительно ускоряет обработку, если в директории появляется несколько файлов одновременно.

### Дополнительные улучшения и автоматизация

### 6. Улучшенная логика удаления исходного файла в `watch_and_transcribe.sh`

**Текущая проблема:** В `watch_and_transcribe.sh` исходный видеофайл удаляется, если `obsidian-ai-transcribe.sh` возвращает код выхода `0`. Однако, если `obsidian-ai-transcribe.sh` завершается с ошибкой, но по какой-то причине возвращает `0`, файл все равно будет удален. Также, если `ai_analyzer.py` завершается с ошибкой, но `obsidian-ai-transcribe.sh` не обрабатывает это должным образом, файл может быть удален.

**Предлагаемое улучшение:** Сделать удаление исходного файла более надежным, убедившись, что заметка Obsidian действительно была создана.

*   **Реализация:** В `watch_and_transcribe.sh` проверять не только код выхода `obsidian-ai-transcribe.sh`, но и наличие созданного файла Markdown в `OBSIDIAN_VAULT_PATH` перед удалением исходного видеофайла. `ai_analyzer.py` может возвращать путь к созданному файлу Markdown, который затем будет использоваться `watch_and_transcribe.sh` для проверки.
*   **Преимущества:** Предотвращает потерю исходных видеофайлов в случае частичного сбоя рабочего процесса.

### 7. Настраиваемый промпт для LLM

**Текущая проблема:** Промпт, используемый для анализа LLM в `scripts/ai_analyzer.py`, жестко закодирован.

**Предлагаемое улучшение:** Разрешить пользователям настраивать промпт LLM.

*   **Реализация:** Перенести промпт LLM в централизованный файл конфигурации (см. п. 3) или в отдельный текстовый файл, который `ai_analyzer.py` будет считывать.
*   **Преимущества:** Позволяет пользователям адаптировать анализ LLM под свои конкретные исследовательские нужды без изменения кода.

### 8. Настраиваемые теги Obsidian

**Текущая проблема:** Теги Obsidian, добавляемые в YAML frontmatter (`jw`, `research`, `transcript`, `{NVIDIA_MODEL}`), жестко закодированы.

**Предлагаемое улучшение:** Разрешить пользователям определять свои собственные теги по умолчанию.

*   **Реализация:** Добавить опцию в централизованный файл конфигурации (см. п. 3), где пользователь может указать список тегов, которые будут автоматически добавляться к каждой заметке.
*   **Преимущества:** Улучшает организацию заметок в Obsidian и соответствует индивидуальным рабочим процессам пользователя.

### 9. Конфигурируемый уровень логирования

**Текущая проблема:** Уровень логирования в `scripts/ai_analyzer.py` жестко установлен на `INFO`.

**Предлагаемое улучшение:** Сделать уровень логирования настраиваемым.

*   **Реализация:** Добавить параметр `LOG_LEVEL` в централизованный файл конфигурации (см. п. 3), который может быть установлен на `DEBUG`, `INFO`, `WARNING`, `ERROR` и т.д.
*   **Преимущества:** Позволяет пользователям получать более подробную информацию для отладки или уменьшать объем вывода для повседневного использования.

### 10. Обработка дубликатов файлов / предотвращение повторной обработки

**Текущая проблема:** Если один и тот же видеофайл (или файл с тем же именем) помещается в `WATCH_DIR` несколько раз, он будет обрабатываться каждый раз, что приводит к повторной транскрибации (если кэш Deepgram не сработал) и повторному анализу LLM.

**Предлагаемое улучшение:** Внедрить механизм для обнаружения и пропуска уже обработанных файлов.

*   **Реализация:**
    *   Перед запуском `obsidian-ai-transcribe.sh`, проверять, существует ли уже заметка Obsidian с соответствующим названием (на основе имени видеофайла) в `OBSIDIAN_VAULT_PATH`.
    *   Если заметка существует, пропускать обработку файла и, возможно, перемещать его в отдельную папку "Обработанные дубликаты" вместо удаления.
*   **Преимущества:** Экономит токены API Deepgram и NVIDIA, предотвращает создание дубликатов заметок в Obsidian.